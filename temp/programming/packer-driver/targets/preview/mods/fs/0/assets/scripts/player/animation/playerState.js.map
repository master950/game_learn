{"version":3,"sources":["file:///C:/Users/14416/Desktop/gameassets/cocos-start-demo-master/assets/scripts/player/animation/playerState.ts"],"names":["PlayerState","AnimationClip","Animation","animation","Sprite","ResourceManage","constructor","_stateMachine","_animManage","_anim","_mode","_animName","WrapMode","Normal","stateMachine","animationManage","_animPath","animMode","animName","name","animPath","path","createAnimClip","spriteFrames","Instance","loadRes","Promise","resolve","reject","animClip","frams","map","item","index","FRAME_TIME","track","ObjectTrack","TrackPath","toComponent","toProperty","channel","curve","assignSorted","addTrack","duration","length","wrapMode","animComp","defaultClip","play","enter","on","EventType","FINISHED","whiteList","some","v","includes","idle","update","exit","stop"],"mappings":"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","sourcesContent":["import { _decorator, AnimationClip, Animation, animation, Sprite, SpriteFrame } from 'cc';\nimport { PlayerAnimController } from 'db://assets/scripts/player/animation/playerAnimController';\nimport ResourceManage from 'db://assets/runtime/resourceManage';\nimport { PlayerStateMachine } from 'db://assets/scripts/player/animation/playerStateMachine';\nimport { DIRECTION } from 'db://assets/Enum';\n\nexport class PlayerState{\n    public stateMachine: PlayerStateMachine;\n    public animationManage: PlayerAnimController;\n    public animMode: AnimationClip.WrapMode;\n    public animClip: AnimationClip;\n    private whiteList = ['turnleft'];\n    private _animName: string;\n    private _animPath: string;\n    FRAME_TIME = 1/10;\n\n    constructor(_stateMachine: PlayerStateMachine, _animManage: PlayerAnimController, _anim: string, _mode: AnimationClip.WrapMode = AnimationClip.WrapMode.Normal, _animName: string = ''){\n        this.stateMachine = _stateMachine;\n        this.animationManage = _animManage;\n        this._animPath = _anim;\n        this.animMode = _mode;\n        this._animName = _animName;\n    }\n\n    get animName(){return this._animName;}\n    set animName(name: string) { this._animName = name }\n\n    get animPath() { return this._animPath; }\n    set animPath(path: string) { this._animPath = path; }\n\n    async createAnimClip(){\n        const spriteFrames = await ResourceManage.Instance.loadRes(this.animPath);\n\n        return new Promise((resolve, reject)=> {\n            this.animClip = new AnimationClip(this.animName);\n            const frams: Array<[number,SpriteFrame]> = spriteFrames.map((item,index)=>[this.FRAME_TIME * index, item])\n            const track  = new animation.ObjectTrack();\n            track.path = new animation.TrackPath().toComponent(Sprite).toProperty('spriteFrame');\n            track.channel.curve.assignSorted(frams);\n\n            // 最后将轨道添加到动画剪辑以应用\n            this.animClip.addTrack(track);\n            this.animClip.duration = frams.length * this.FRAME_TIME; // 整个动画剪辑的周期\n            this.animClip.wrapMode = this.animMode;\n            this.animationManage.animComp.defaultClip = this.animClip;\n            this.animationManage.animComp.play();\n        })\n    }\n\n    enter(){\n        if(!this.animClip) { this.createAnimClip(); }\n        else {\n            this.animationManage.animComp.defaultClip = this.animClip;\n            this.animationManage.animComp.play();\n        }\n        this.animationManage.animComp.on(Animation.EventType.FINISHED, ()=>{\n            const name = this.animationManage.animComp.defaultClip.name;\n            if(this.whiteList.some(v=> v.includes(name))) this.animationManage.idle();\n        })\n    }\n\n    update(){\n\n    }\n\n    exit(){\n        this.animationManage.animComp.stop();\n    }\n\n}\n"]}