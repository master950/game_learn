{"version":3,"sources":["file:///C:/Users/14416/Desktop/gameassets/cocos-start-demo-master/assets/scripts/sence/batleManage.ts"],"names":["_decorator","Component","tileManage","createUINode","levels","DataManage","TILE_HEIGHT","TILE_WIDTH","EventManage","EVENT_NAME","PlayerManage","ccclass","property","batleManage","start","generateStage","initLevel","generatePlayer","onLoad","Instance","on","NEXT_LEVEL","nextLevel","onDestroy","off","levelIndex","level","mapInfo","mapColumnCount","length","mapRowCount","generateTileMap","clearLevel","stage","destroyAllChildren","reset","setParent","node","tileMap","manage","addComponent","init","adaptPosition","player","playerManage","disX","disY","setPosition"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from 'cc';\nimport { tileManage } from 'db://assets/scripts/tile/tileManage';\nimport { createUINode } from 'db://assets/utils/index';\nimport levels, { ILevel } from 'db://assets/levels/index';\nimport DataManage from 'db://assets/runtime/dataManage';\nimport { TILE_HEIGHT, TILE_WIDTH } from '../tile/tile';\nimport EventManage from 'db://assets/runtime/eventManage';\nimport { EVENT_NAME } from 'db://assets/Enum/index';\nimport { PlayerManage } from '../player/playerManage';\nconst { ccclass, property } = _decorator;\n\n@ccclass('batleManage')\nexport class batleManage extends Component {\n\n    // 地图信息\n    level: ILevel\n    stage: Node\n\n    start () {\n        this.generateStage();\n        this.initLevel();\n        this.generatePlayer();\n    }\n\n    protected onLoad(): void {\n        EventManage.Instance.on(EVENT_NAME.NEXT_LEVEL, this.nextLevel, this);\n    }\n\n    protected onDestroy(): void {\n        EventManage.Instance.off(EVENT_NAME.NEXT_LEVEL, this.nextLevel);\n    }\n\n    // 下一关事件\n    nextLevel(){\n        DataManage.Instance.levelIndex++;\n        this.initLevel();\n     }\n\n    initLevel(){\n        const level = levels[`level${DataManage.Instance.levelIndex}`];\n\n        if(level){\n            this.level = level;\n            DataManage.Instance.mapInfo = this.level.mapInfo;\n            DataManage.Instance.mapColumnCount = this.level.mapInfo[0].length;\n            DataManage.Instance.mapRowCount = this.level.mapInfo.length;\n        }\n\n        this.generateTileMap();\n    }\n\n    // 清除关卡信息\n    clearLevel(){\n        // 清除舞台渲染的所有子元素\n        this.stage.destroyAllChildren();\n        // 清除上一关的关卡数据\n        DataManage.Instance.reset();\n    }\n\n    generateStage(){\n        this.stage = createUINode();\n        this.stage.setParent(this.node);\n    }\n\n    generateTileMap(){\n          // 创建TileMap\n          const tileMap = createUINode();\n          tileMap.setParent(this.stage);\n          const manage = tileMap.addComponent(tileManage);\n          manage.init();\n\n          this.adaptPosition();\n    }\n\n    generatePlayer(){\n        const player = createUINode();\n        player.setParent(this.stage);\n        const playerManage = player.addComponent(PlayerManage);\n        playerManage.init();\n    }\n\n    // 将地图往左上偏移地图一半的长度\n    adaptPosition(){\n        const {mapColumnCount,mapRowCount} = DataManage.Instance;\n        const disX = mapRowCount / 2 * TILE_WIDTH;\n        const disY = mapColumnCount / 2 * TILE_HEIGHT + 88;\n        this.stage.setPosition(-disX,disY);\n    }\n\n}\n"]}